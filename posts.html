<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>All Posts — Boluadeoye (Minimal)</title>
  <style>
    body { margin: 0; font: 16px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; background: #0f172a; color: #e5eefc; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 1rem; }
    header { position: sticky; top: 0; background: #0f172a; border-bottom: 1px solid #223; padding: .8rem 1rem; }
    h1 { margin: 0; font-size: 1.2rem; }
    h2 { margin: 1rem 0 .5rem; font-size: 1.25rem; color: #f59e0b; }
    a { color: #fbbf24; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .error { margin: 1rem 0; color: #ff6b6b; }
    .muted { color: #94a3b8; font-size: .9rem; }
    .grid { display: grid; grid-template-columns: 1fr; gap: .9rem; }
    .card { display: flex; gap: .8rem; background: #111a2e; border: 1px solid #223; border-radius: 10px; padding: .8rem; }
    .thumb { width: 120px; height: 72px; border-radius: 8px; background: #0b1224; border: 1px solid #223; overflow: hidden; flex: 0 0 auto; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .card h3 { margin: 0 0 .25rem; font-size: 1rem; }
    .meta { font-size: .85rem; color: #94a3b8; margin-bottom: .25rem; }
    .excerpt { font-size: .92rem; color: #dbe7fa; }
    .search { margin: .5rem 0 1rem; }
    .search input { width: 100%; padding: .6rem .8rem; border-radius: 8px; border: 1px solid #223; background: #0b1224; color: #e5eefc; outline: none; }
    @media (min-width: 720px){ .grid { grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
  <header class="wrap">
    <h1>All Posts — Minimal</h1>
    <div class="muted">Project path: /Mywebsite — all paths are relative</div>
    <div><a href="./">← Home</a></div>
  </header>

  <main class="wrap">
    <div class="search">
      <input id="q" type="text" placeholder="Search title, excerpt, or type…"/>
    </div>
    <div id="status" class="muted">Loading posts…</div>
    <div id="grid" class="grid"></div>
  </main>

  <script>
    (function(){
      // ES5 XHR helper
      function xhrJSON(url, cb){
        try{
          var x = new XMLHttpRequest();
          x.open('GET', url, true);
          x.onreadystatechange = function(){
            if (x.readyState === 4){
              if (x.status >= 200 && x.status < 300){
                try { cb(null, JSON.parse(x.responseText)); }
                catch(e){ cb(new Error('Invalid JSON at '+url)); }
              } else { cb(new Error('HTTP '+x.status+' for '+url)); }
            }
          };
          x.send(null);
        }catch(e){ cb(e); }
      }

      var statusEl = document.getElementById('status');
      var gridEl = document.getElementById('grid');
      var qEl = document.getElementById('q');
      var all = [];

      function fmtDate(s){
        try { return new Date(s).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'}); }
        catch(e){ return s || ''; }
      }

      function render(list){
        if (!gridEl) return;
        if (!list || !list.length){
          gridEl.innerHTML = '';
          statusEl.innerHTML = 'No posts match your search.';
          return;
        }
        statusEl.innerHTML = '';
        var html = '';
        for (var i=0;i<list.length;i++){
          var p = list[i];
          var title = p.title || 'Untitled';
          var file = p.file || '';
          var date = fmtDate(p.date);
          var type = p.type || '';
          var excerpt = p.excerpt || '';
          var cover = p.cover || '';
          html += '<article class="card">' +
                    (cover ? ('<a class="thumb" href="post.html?file='+ encodeURIComponent(file) +'"><img src="'+ cover +'" alt="cover"></a>')
                           : '<a class="thumb" href="post.html?file='+ encodeURIComponent(file) +'"></a>') +
                    '<div class="info">' +
                      '<h3><a href="post.html?file='+ encodeURIComponent(file) +'">'+ title +'</a></h3>' +
                      '<div class="meta">'+ (date?date:'') + (type? (' • ' + type):'') +'</div>' +
                      '<div class="excerpt">'+ excerpt +'</div>' +
                    '</div>' +
                  '</article>';
        }
        gridEl.innerHTML = html;
      }

      function applySearch(){
        var q = (qEl && qEl.value ? qEl.value : '').toLowerCase();
        if (!q){ render(all); return; }
        var out = [];
        for (var i=0;i<all.length;i++){
          var p = all[i];
          var blob = (p.title||'') + ' ' + (p.excerpt||'') + ' ' + (p.type||'');
          if (blob.toLowerCase().indexOf(q) !== -1) out.push(p);
        }
        render(out);
      }

      // Load Posts.json (relative path so it works under /Mywebsite/)
      xhrJSON('Posts.json', function(err, data){
        if (err){
          statusEl.className = 'error';
          statusEl.innerHTML = 'Could not load Posts.json — ' + err.message;
          return;
        }
        if (!data || !data.length){
          statusEl.innerHTML = 'No posts found in Posts.json';
          return;
        }
        // sort by date desc
        data.sort(function(a,b){ return String(b.date).localeCompare(String(a.date)); });
        all = data;
        render(all);
      });

      if (qEl){
        qEl.addEventListener('input', function(){ applySearch(); });
      }
    })();
  </script>
</body>
</html>
