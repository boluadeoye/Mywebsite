<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post • Boluadeoye</title>

  <!-- Everything on the site lives under /Mywebsite -->
  <base href="/Mywebsite/">

  <style>
    :root{
      --bg:#0f172a; --panel:#111a2e;
      --ink:#e5eefc; --muted:#a7b3cc;
      --orange:#f59e0b; --orange-ink:#0b0f19;
      --ring:rgba(245,158,11,.25);
      --radius:16px; --serif: ui-serif, Georgia, "Times New Roman", serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:920px;margin:0 auto;padding:0 1.2rem}

    /* Header */
    header{
      position:sticky; top:0; z-index:5; background:var(--panel);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .row{min-height:64px;display:flex;align-items:center;gap:1rem}
    .brand{display:flex;align-items:center;gap:.6rem;margin-left:.5rem}
    .dot{
      width:28px;height:28px;border-radius:50%;
      background:radial-gradient(65% 65% at 30% 30%,#ffd27a 0%,#f59e0b 55%,#a55e03 100%);
      box-shadow:0 0 0 3px rgba(245,158,11,.12),0 10px 26px rgba(245,158,11,.25);
    }
    .brand h1{margin:0;font-size:1.25rem;font-weight:800;letter-spacing:.2px}
    .back-top{margin-left:auto;color:#fbbf24;font-weight:700;opacity:.95}
    .back-top:hover{opacity:1}

    /* Card & post styles */
    .card{
      background:var(--panel);
      border:1px solid rgba(255,255,255,.06);
      border-radius:24px;
      padding:1.25rem;
      margin:1rem 0 2rem;
      box-shadow:0 12px 28px rgba(0,0,0,.25);
    }
    .post h1{
      font-family:var(--serif);
      font-weight:900;
      line-height:1.08;
      font-size:clamp(2.2rem,5.8vw,3.2rem);
      margin:.25rem 0 .75rem;
    }
    .meta{color:var(--muted);margin:.25rem 0 1.25rem}
    .post p{margin:1rem 0}
    .post h2,.post h3{margin:1.4rem 0 .6rem}
    blockquote{
      margin:1.2rem 0; padding:1rem 1.25rem;
      background:rgba(255,255,255,.03);
      border-radius:14px;
      border-left:6px solid var(--orange);
    }

    /* Bottom back button (single, consistent) */
    .cta{
      display:inline-block;
      margin-top:1rem;
      padding:1rem 1.25rem;
      border-radius:14px;
      background:var(--orange);
      color:var(--orange-ink);
      font-weight:800;
      box-shadow:0 14px 38px var(--ring);
      transition:transform .06s ease;
    }
    .cta:active{transform:translateY(1px)}

    /* Footer */
    footer{
      color:var(--muted);
      border-top:1px solid rgba(255,255,255,.06);
      text-align:center;
      font-size:.85rem;
      padding:2rem 0 1.5rem;
      margin-top:1rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <a class="brand" href="./">
        <span class="dot" aria-hidden="true"></span>
        <h1>Boluadeoye</h1>
      </a>
      <a class="back-top" href="./#latest">← Back to writings</a>
    </div>
  </header>

  <main class="wrap">
    <article id="postContainer" class="card post" aria-live="polite">
      <p style="color:var(--muted)">Loading…</p>
    </article>
  </main>

  <footer>
    <div class="wrap">© Boluadeoye 2025 • All rights reserved.</div>
  </footer>

  <script>
  (async function () {
    const params = new URLSearchParams(location.search);
    const fileParam = params.get('file');              // e.g. "posts/discipline.html"
    const container = document.getElementById('postContainer');

    if (!fileParam) {
      container.innerHTML = "<p style='color:#fbbf24'>No post specified.</p>";
      return;
    }

    // Build absolute URLs under /Mywebsite regardless of <base>
    const root = location.origin + '/Mywebsite/';
    const postUrl = new URL(fileParam, root);
    const jsonUrl = new URL('posts.json', root);
    jsonUrl.searchParams.set('v', Date.now());         // bypass cache every load

    try {
      // Load source HTML & posts.json together
      const [postRes, listRes] = await Promise.all([
        fetch(postUrl.toString(), { cache:'no-store' }),
        fetch(jsonUrl.toString(), { cache:'no-store' })
      ]);
      if (!postRes.ok) throw new Error('Post fetch failed: ' + postRes.status);
      if (!listRes.ok) throw new Error('posts.json fetch failed: ' + listRes.status);

      const [postHtml, list] = await Promise.all([postRes.text(), listRes.json()]);
      if (!Array.isArray(list)) throw new Error('posts.json malformed');

      // Find the metadata for this file (title/date/minutes/type)
      const normalized = fileParam.replace(/^\.\//,'').replace(/^\/+/,'');
      const meta = list.find(item=>{
        try{
          const u = new URL(item.url, root);           // post.html?file=posts/xyz.html
          const f = new URLSearchParams(u.search).get('file') || '';
          return f.replace(/^\.\//,'').replace(/^\/+/,'') === normalized;
        }catch(_){ return false }
      }) || {};

      // Parse HTML, pick the meaningful content region
      const doc = new DOMParser().parseFromString(postHtml, 'text/html');
      const pick = doc.querySelector('article') || doc.querySelector('main') || doc.body;

      // Clone and CLEAN: remove any back links/buttons/headers that came from the post
      const tmp = document.createElement('div');
      tmp.innerHTML = pick.innerHTML;

      // 1) remove first h1/small/header/footer/nav from the post file
      ['h1','small','header','footer','nav'].forEach(sel=>{
        const el = tmp.querySelector(sel); if (el) el.remove();
      });

      // 2) nuke anything that looks like a back/cta/button from the source
      tmp.querySelectorAll('*').forEach(el=>{
        const cls = (el.className||'').toString().toLowerCase();
        const txt = (el.textContent||'').toLowerCase();
        const href = (el.getAttribute && (el.getAttribute('href')||'').toLowerCase()) || '';
        const isBtn = /btn|button|cta|back/.test(cls) ||
                      txt.includes('back to') ||
                      href.includes('#latest') ||
                      href.includes('index.html');
        if (isBtn && (el.tagName === 'A' || el.tagName === 'BUTTON' || el.tagName === 'DIV' || el.tagName === 'P')) {
          el.remove();
        }
      });

      // 3) normalize internal links inside the body to live under /Mywebsite
      tmp.querySelectorAll('a[href]').forEach(a=>{
        const href = a.getAttribute('href')||'';
        const low = href.toLowerCase();
        if (low.startsWith('http') || low.startsWith('mailto:') || low.startsWith('https://wa.me') || low.startsWith('#')) return;
        a.setAttribute('href', new URL(href, root).pathname + new URL(href, root).search + new URL(href, root).hash);
      });

      // Compose consistent page
      const title = (meta.title || (doc.querySelector('h1') && doc.querySelector('h1').textContent) || 'Untitled').trim();
      const mins  = meta.minutes ? ` • ${meta.minutes} min read` : '';
      const type  = meta.type ? ` • ${String(meta.type).toUpperCase()}` : '';
      const date  = meta.date || '';

      document.title = `${title} • Boluadeoye`;

      container.innerHTML = `
        <h1>${title}</h1>
        <div class="meta">${date}${mins}${type}</div>
        <div class="body">${tmp.innerHTML}</div>
      `;

      // Add ONE orange back button
      const back = document.createElement('a');
      back.href = './#latest';
      back.className = 'cta';
      back.textContent = '↩ Back to Latest';
      container.appendChild(back);

    } catch (err) {
      console.error(err);
      container.innerHTML = "<p style='color:#fbbf24'>Couldn't load this post. (" +
                            String(err.message) + ")</p>";
    }
  })();
  </script>
</body>
</html>
