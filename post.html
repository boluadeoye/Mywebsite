<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post • Boluadeoye</title>

  <!-- All assets/links live under /Mywebsite -->
  <base href="/Mywebsite/">

  <style>
    :root{
      --bg:#0f172a; --panel:#111a2e;
      --ink:#e5eefc; --muted:#a7b3cc;
      --orange:#f59e0b; --orange-ink:#0b0f19;
      --ring:rgba(245,158,11,.25);
      --radius:16px; --serif: ui-serif, Georgia, "Times New Roman", serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:920px;margin:0 auto;padding:0 1.2rem}

    /* Header */
    header{position:sticky;top:0;z-index:5;background:var(--panel);
      border-bottom:1px solid rgba(255,255,255,.06)}
    .row{min-height:64px;display:flex;align-items:center;gap:1rem}
    .brand{display:flex;align-items:center;gap:.6rem;margin-left:.5rem}
    .dot{width:28px;height:28px;border-radius:50%;
      background:radial-gradient(65% 65% at 30% 30%,#ffd27a 0%,#f59e0b 55%,#a55e03 100%);
      box-shadow:0 0 0 3px rgba(245,158,11,.12),0 10px 26px rgba(245,158,11,.25);}
    .brand h1{margin:0;font-size:1.25rem;font-weight:800;letter-spacing:.2px}
    .back-top{margin-left:auto;color:#fbbf24;font-weight:700;opacity:.95}
    .back-top:hover{opacity:1}

    /* Card & post styles */
    .card{
      background:var(--panel); border:1px solid rgba(255,255,255,.06);
      border-radius:24px; padding:1.25rem; box-shadow:0 12px 28px rgba(0,0,0,.25);
      margin:1rem 0 2rem;
    }
    .post h1{font-family:var(--serif);font-weight:900;line-height:1.1;
      font-size:clamp(2.2rem,5.8vw,3.2rem);margin:.25rem 0 .75rem}
    .meta{color:var(--muted);margin:.25rem 0 1.25rem}
    .post p{margin:1rem 0}
    .post h2,.post h3{margin:1.4rem 0 .6rem}
    blockquote{
      margin:1.2rem 0; padding:1rem 1.25rem;
      background:rgba(255,255,255,.03); border-radius:14px;
      border-left:6px solid var(--orange);
    }

    /* Bottom back button */
    .cta{
      display:inline-block; margin-top:1rem; padding:1rem 1.25rem;
      border-radius:14px; background:var(--orange); color:var(--orange-ink);
      font-weight:800; box-shadow:0 14px 38px var(--ring);
      transition:transform .06s ease;
    }
    .cta:active{transform:translateY(1px)}

    /* Footer */
    footer{color:var(--muted);border-top:1px solid rgba(255,255,255,.06);
      text-align:center;font-size:.85rem;padding:2rem 0 1.5rem;margin-top:1rem}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <a class="brand" href="./">
        <span class="dot" aria-hidden="true"></span>
        <h1>Boluadeoye</h1>
      </a>
      <a class="back-top" href="./#latest">← Back to writings</a>
    </div>
  </header>

  <main class="wrap">
    <!-- We will render a clean template here -->
    <article id="postContainer" class="card post" aria-live="polite">
      <p style="color:var(--muted)">Loading…</p>
    </article>
  </main>

  <footer>
    <div class="wrap">© Boluadeoye 2025 • All rights reserved.</div>
  </footer>

  <script>
  (async function () {
    const fileParam = new URLSearchParams(location.search).get('file'); // e.g. posts/discipline.html
    const container = document.getElementById('postContainer');

    if (!fileParam) {
      container.innerHTML = "<p style='color:#fbbf24'>No post specified.</p>";
      return;
    }

    // Build absolute URLs under /Mywebsite/
    const root = location.origin + '/Mywebsite/';
    const postUrl = new URL(fileParam, root);
    const jsonUrl = new URL('posts.json', root);
    jsonUrl.searchParams.set('v', String(Date.now())); // bypass cache

    try {
      // Fetch post HTML and posts.json in parallel
      const [postRes, listRes] = await Promise.all([
        fetch(postUrl.toString(), { cache:'no-store' }),
        fetch(jsonUrl.toString(), { cache:'no-store' }),
      ]);
      if (!postRes.ok) throw new Error('Post fetch failed: ' + postRes.status);
      if (!listRes.ok) throw new Error('posts.json fetch failed: ' + listRes.status);

      const [postHtml, list] = await Promise.all([postRes.text(), listRes.json()]);
      if (!Array.isArray(list)) throw new Error('posts.json malformed');

      // Find matching entry in posts.json (by file path)
      const filePath = fileParam.replace(/^\.\//,'').replace(/^\/+/,''); // normalize
      const entry = list.find(it => {
        if (!it || !it.url) return false;
        try{
          const u = new URL(it.url, root);        // post.html?file=posts/discipline.html
          const q = new URLSearchParams(u.search);
          const f = (q.get('file')||'').replace(/^\.\//,'').replace(/^\/+/,'');
          return f === filePath;
        }catch(_){return false}
      }) || {};

      // Parse post HTML and extract body content
      const doc  = new DOMParser().parseFromString(postHtml, 'text/html');
      const pick = doc.querySelector('article') || doc.querySelector('main') || doc.body;

      // Clone & clean: remove any h1/meta/back links inside source
      const tmp = document.createElement('div');
      tmp.innerHTML = pick.innerHTML;

      // drop any first h1/small and “back” links
      const firstH1 = tmp.querySelector('h1'); if (firstH1) firstH1.remove();
      const firstSmall = tmp.querySelector('small'); if (firstSmall) firstSmall.remove();
      tmp.querySelectorAll('a').forEach(a=>{
        const t=(a.textContent||'').toLowerCase();
        const h=(a.getAttribute('href')||'').toLowerCase();
        if (t.includes('back to latest') || t.includes('back to writings') || h.endsWith('#latest')) a.remove();
      });

      // Compose consistent page
      const title = (entry.title || (doc.querySelector('h1') && doc.querySelector('h1').textContent) || 'Untitled').trim();
      const mins  = entry.minutes ? ` • ${entry.minutes} min read` : '';
      const type  = entry.type ? ` • ${String(entry.type).toUpperCase()}` : '';
      const date  = entry.date || '';

      document.title = `${title} • Boluadeoye`;

      container.innerHTML = `
        <h1>${title}</h1>
        <div class="meta">${date}${mins}${type}</div>
        <div class="body">${tmp.innerHTML}</div>
      `;

      // Normalize internal links in the body to live under /Mywebsite
      container.querySelectorAll('.body a[href]').forEach(a=>{
        const href = a.getAttribute('href')||'';
        const low = href.toLowerCase();
        if (low.startsWith('http') || low.startsWith('mailto:') || low.startsWith('https://wa.me') || low.startsWith('#')) return;
        const abs = new URL(href, root);
        a.setAttribute('href', abs.pathname + abs.search + abs.hash);
      });

      // Consistent single bottom button
      const backBottom = document.createElement('a');
      backBottom.href = './#latest';
      backBottom.className = 'cta';
      backBottom.textContent = '↩ Back to Latest';
      container.appendChild(backBottom);

    } catch (err) {
      console.error(err);
      container.innerHTML = "<p style='color:#fbbf24'>Couldn't load this post. (" +
                            String(err.message) + ")</p>";
    }
  })();
  </script>
</body>
</html>
