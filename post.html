<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post - Boluadeoye</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
  <script src="/marked.min.js"></script> <!-- Adjusted path -->
  <style>
    /* Same as previous */
  </style>
</head>
<body>
  <!-- Same HTML as previous -->
  <script>
    window.addEventListener('scroll', () => {
      const header = document.getElementById('header');
      if (window.scrollY > 50) header.classList.add('scrolled'); else header.classList.remove('scrolled');
    });
    function processMarkdown(text) {
      if (!text || typeof text !== 'string') {
        console.error('Invalid Markdown content:', text);
        return '<p>Content unavailable.</p>';
      }
      if (typeof marked === 'undefined') {
        console.error('Markdown parser (marked) not loaded. Check if /marked.min.js exists at', window.location.origin + '/marked.min.js');
        return '<p>Error: Markdown parser not loaded. Please ensure marked.min.js is present or contact support.</p>';
      }
      console.log('Markdown parser loaded successfully');
      return marked.parse(text);
    }
    async function loadPost() {
      const container = document.getElementById('post-content-wrapper');
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const file = urlParams.get('file');
        if (!file) throw new Error("No post file specified in URL.");
        console.log('Fetching Posts.json from:', window.location.origin + '/Posts.json');
        const postsRes = await fetch('/Posts.json', { cache: 'no-store' });
        if (!postsRes.ok) throw new Error(`Failed to fetch Posts.json (HTTP ${postsRes.status})`);
        const posts = await postsRes.json();
        const postData = posts.find(p => p.file === file);
        if (!postData) throw new Error(`Post "${file}" not found in Posts.json`);
        console.log(`Fetching Markdown file: ${file} from:`, window.location.origin + '/' + file);
        let mdRes = await fetch(file, { cache: 'no-store' });
        if (!mdRes.ok && mdRes.status === 404) {
          const parts = file.split('/');
          const basename = parts.pop();
          const lowerTry = parts.join('/') + '/' + basename.toLowerCase();
          console.log(`Trying fallback: ${lowerTry}`);
          const fallbackRes = await fetch(lowerTry, { cache: 'no-store' });
          if (fallbackRes.ok) mdRes = fallbackRes;
        }
        if (!mdRes.ok) throw new Error(`Failed to load Markdown file at ${file} (HTTP ${mdRes.status})`);
        const markdown = await mdRes.text();
        const content = processMarkdown(markdown);
        document.title = `${postData.title} - Boluadeoye`;
        container.innerHTML = `
          <div class="post-header">
            <div class="post-meta">
              <span class="meta-item">üìÖ ${new Date(postData.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
              <span class="meta-item">üìÅ ${postData.type || 'general'}</span>
              <span class="meta-item">‚ù§Ô∏è ${postData.likes || 0} likes</span>
              <span class="meta-item">üëÅÔ∏è ${postData.views || 0}K views</span>
            </div>
            <h1 class="post-title">${postData.title}</h1>
          </div>
          <div class="post-content">${content}</div>
          <nav class="post-nav">
            <a href="./" class="btn-chip">‚Üê Back to Home</a>
            <a href="./posts.html" class="btn-chip">View All Posts ‚Üí</a>
          </nav>`;
        window.scrollTo(0, 0);
      } catch (error) {
        console.error("Error loading post:", error);
        container.innerHTML = `
          <div class="error">
            <h2>Unable to Load Post</h2>
            <p>Error: ${error.message}</p>
            <p>Please check if the post file exists or contact support.</p>
            <div class="post-nav">
              <a href="./" class="btn-chip">‚Üê Return to Homepage</a>
            </div>
          </div>`;
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof marked === 'undefined') {
        console.error('Marked library not loaded at DOMContentLoaded. Check if /marked.min.js exists at', window.location.origin + '/marked.min.js');
        document.getElementById('post-content-wrapper').innerHTML = `
          <div class="error">
            <h2>Unable to Load Post</h2>
            <p>Error: Markdown parser not loaded. Please ensure marked.min.js is present or contact support.</p>
            <div class="post-nav">
              <a href="./" class="btn-chip">‚Üê Return to Homepage</a>
            </div>
          </div>`;
      } else {
        console.log('Starting loadPost...');
        loadPost();
      }
    });
    window.addEventListener('load', () => {
      if (document.getElementById('post-content-wrapper')) {
        const giscusScript = document.createElement('script');
        giscusScript.src = "https://giscus.app/client.js";
        giscusScript.setAttribute("data-repo", "boluadeoye/boluadeoye.github.io");
        giscusScript.setAttribute("data-repo-id", "R_kgDOPrdLFg");
        giscusScript.setAttribute("data-category", "Comments");
        giscusScript.setAttribute("data-category-id", "DIC_kwDOPrdLFs4CvVjy");
        giscusScript.setAttribute("data-mapping", "pathname");
        giscusScript.setAttribute("data-strict", "0");
        giscusScript.setAttribute("data-reactions-enabled", "1");
        giscusScript.setAttribute("data-emit-metadata", "0");
        giscusScript.setAttribute("data-input-position", "bottom");
        giscusScript.setAttribute("data-theme", "dark");
        giscusScript.setAttribute("data-lang", "en");
        giscusScript.setAttribute("crossorigin", "anonymous");
        giscusScript.async = true;
        const commentsSection = document.createElement('section');
        commentsSection.id = 'comments';
        commentsSection.className = 'wrap';
        commentsSection.style.marginTop = '4rem';
        commentsSection.innerHTML = `
          <div style="background: var(--panel); border: 1px solid rgba(255,255,255,.06); border-radius: 16px; padding: 2rem; max-width: 900px; margin: 0 auto;">
            <h3 style="color: #f59e0b; font-family: var(--serif); margin: 0 0 1.5rem; text-align: center;">Join the Conversation</h3>
          </div>
        `;
        document.querySelector('.post-container').after(commentsSection);
        commentsSection.appendChild(giscusScript);
      }
    });
  </script>
</body>
</html>
