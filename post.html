<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Post — Boluadeoye (Minimal)</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { margin: 0; font: 16px/1.65 "Open Sans", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; background: #0f172a; color: #e5eefc; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 1rem; }
    header { position: sticky; top: 0; background: #0f172a; border-bottom: 1px solid #223; padding: .8rem 1rem; }
    a { color: #fbbf24; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .title { color: #f59e0b; margin: .6rem 0 .2rem; }
    .meta { color: #94a3b8; font-size: .9rem; margin-bottom: .8rem; }
    .content { background: #111a2e; border: 1px solid #223; border-radius: 12px; padding: 1rem; }
    .error { color: #ff6b6b; margin: 1rem 0; }
    .muted { color: #94a3b8; font-size: .9rem; }
    figure.cover { margin: .8rem 0 1rem; }
    figure.cover img { width: 100%; height: auto; border-radius: 10px; display: block; }
    .nav { margin: 1rem 0; }
  </style>
</head>
<body>
  <header class="wrap">
    <a href="./">← Home</a>
  </header>

  <main class="wrap">
    <h1 id="post-title" class="title">Loading…</h1>
    <div id="post-meta" class="meta"></div>
    <div id="cover"></div>
    <div id="status" class="muted">Loading your post…</div>
    <article id="content" class="content"></article>
    <div class="nav"><a href="./posts.html">All posts →</a></div>
  </main>

  <script>
    (function(){
      // --- tiny helpers ---
      function parseQuery(q){
        var out = {}, i, p;
        if (!q) return out;
        if (q.charAt(0) === '?') q = q.substring(1);
        var arr = q.split('&');
        for (i=0;i<arr.length;i++){
          p = arr[i].split('=');
          if (p[0]) out[decodeURIComponent(p[0])] = decodeURIComponent((p[1]||'').replace(/\+/g,' '));
        }
        return out;
      }
      function xhrJSON(url, cb){
        try{
          var x = new XMLHttpRequest();
          x.open('GET', url, true);
          x.onreadystatechange = function(){
            if (x.readyState === 4){
              if (x.status >= 200 && x.status < 300){
                try { cb(null, JSON.parse(x.responseText)); }
                catch(e){ cb(new Error('Invalid JSON at '+url)); }
              } else { cb(new Error('HTTP '+x.status+' for '+url)); }
            }
          };
          x.send(null);
        }catch(e){ cb(e); }
      }
      function xhrText(url, cb){
        try{
          var x = new XMLHttpRequest();
          x.open('GET', url, true);
          x.onreadystatechange = function(){
            if (x.readyState === 4){
              if (x.status >= 200 && x.status < 300){
                cb(null, x.responseText);
              } else { cb(new Error('HTTP '+x.status+' for '+url)); }
            }
          };
          x.send(null);
        }catch(e){ cb(e); }
      }

      var q = parseQuery(window.location.search);
      var file = q.file || '';
      var statusEl = document.getElementById('status');
      var contentEl = document.getElementById('content');
      var titleEl = document.getElementById('post-title');
      var metaEl = document.getElementById('post-meta');
      var coverEl = document.getElementById('cover');

      if (!file){
        statusEl.className = 'error';
        statusEl.innerHTML = 'No post file specified. Try: post.html?file=posts/morning-dew.md';
        titleEl.innerHTML = 'No file';
        return;
      }

      // Optional metadata
      var postData = null;
      xhrJSON('Posts.json', function(err, posts){
        if (!err && posts && posts.length){
          for (var i=0;i<posts.length;i++){
            if (posts[i] && posts[i].file === file){ postData = posts[i]; break; }
          }
        }
        // Load the markdown
        xhrText(file, function(err2, md){
          if (err2){
            statusEl.className = 'error';
            statusEl.innerHTML = 'Could not load "'+file+'". ' + err2.message;
            titleEl.innerHTML = 'Load error';
            return;
          }
          statusEl.innerHTML = '';
          // Title & meta
          var title = (postData && postData.title) ? postData.title : 'Untitled';
          document.title = title + ' — Boluadeoye';
          titleEl.innerHTML = title;
          var metaTxt = '';
          if (postData && postData.date){
            try { metaTxt += new Date(postData.date).toLocaleDateString('en-US', {year:'numeric',month:'long',day:'numeric'}); } catch(e){}
          }
          if (postData && postData.type){ metaTxt += (metaTxt?' • ':'') + postData.type; }
          metaEl.innerHTML = metaTxt;

          // Cover (front matter cover or first MD image)
          var cover = (postData && postData.cover) ? String(postData.cover).trim() : '';
          if (!cover){
            var m = md.match(/!```math
[^```]*```KATEX_INLINE_OPEN([^)]+)KATEX_INLINE_CLOSE/);
            if (m && m[1]) cover = m[1].trim();
            // If we use the first image as cover, hide that one in content
            if (cover && m && m[0]) md = md.replace(m[0], '');
          }
          coverEl.innerHTML = cover ? '<figure class="cover"><img src="'+cover+'" alt="cover"></figure>' : '';

          // Render markdown
          try {
            contentEl.innerHTML = marked.parse(md);
          } catch(e) {
            statusEl.className = 'error';
            statusEl.innerHTML = 'Markdown render failed: ' + e.message;
          }
        });
      });
    })();
  </script>
</body>
</html>
