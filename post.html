<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Post • Boluadeoye</title>

  <style>
    /* ===== Theme (match homepage) ===== */
    :root{
      --bg:#0f172a;         /* page background */
      --panel:#111a2e;      /* cards/header surface */
      --ink:#e5eefc;        /* main text */
      --muted:#a7b3cc;      /* secondary text */
      --orange:#f59e0b;     /* accent/CTA */
      --orange-ink:#0b0f19; /* text on orange */
      --ring:rgba(245,158,11,.25);
      --radius:20px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      line-height:1.65;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    a{color:inherit;text-decoration:none}

    .wrap{max-width:980px;margin:0 auto;padding:1.1rem}

    /* ===== Header ===== */
    header{
      position:sticky; top:0; z-index:10;
      background:var(--panel);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .header-row{
      display:flex; align-items:center; justify-content:space-between;
      padding:.75rem 0;
    }
    .brand{
      display:flex; align-items:center; gap:.75rem;
      text-decoration:none;
    }
    .brand-dot{
      width:36px; height:36px; border-radius:999px;
      background:radial-gradient(circle at 35% 35%, #ffd166 0%, #f59e0b 55%, #c77700 100%);
      box-shadow:0 0 0 6px rgba(245,158,11,.10), 0 12px 36px var(--ring);
      flex:0 0 36px;
    }
    .brand h1{ font-size:1.2rem; margin:0; font-weight:800; letter-spacing:.2px }
    .back-link{
      color:var(--orange); font-weight:700; opacity:.95;
      display:inline-flex; align-items:center; gap:.45rem;
    }

    /* ===== Card / Post ===== */
    .card{
      background:var(--panel);
      border-radius:var(--radius);
      padding:clamp(1rem, 3vw, 1.75rem);
      box-shadow:0 18px 50px rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.05);
    }
    .post{
      margin:clamp(1rem, 2.5vw, 2rem) auto;
    }
    .post h1{
      font-size:clamp(2.1rem, 7vw, 3.6rem);
      line-height:1.08;
      margin:.25rem 0 1rem 0;
      letter-spacing:.3px;
      font-weight:800;
    }
    .meta{
      color:var(--muted);
      margin:.25rem 0 1.6rem;
      font-size:1rem;
      letter-spacing:.25px;
    }
    .body > p{ margin:0 0 1rem 0; }
    .body blockquote{
      margin:1.25rem 0; padding:1rem 1.25rem;
      border-left:6px solid var(--orange);
      background:rgba(255,255,255,.04);
      border-radius:14px;
    }

    /* CTA */
    .cta{
      display:block; text-align:center; font-weight:800;
      background:var(--orange); color:var(--orange-ink);
      padding:1rem 1.25rem; border-radius:16px;
      box-shadow:0 18px 50px var(--ring);
      max-width:260px; margin:2rem auto 0;
    }
    .cta:active{ transform:translateY(1px) }

    /* Footer */
    footer{
      text-align:center; color:var(--muted);
      border-top:1px solid rgba(255,255,255,.06);
      margin:2rem 0 0; padding:1.25rem 0 2rem;
      font-size:.92rem;
    }

    /* Responsive polish */
    @media (min-width:900px){
      .post{ padding:clamp(1.25rem, 2.5vw, 2rem) }
    }
  </style>
</head>
<body>
  <!-- ===== Sticky header ===== -->
  <header>
    <div class="wrap header-row">
      <a id="brandHome" class="brand" href="#">
        <span class="brand-dot" aria-hidden="true"></span>
        <h1>Boluadeoye</h1>
      </a>
      <a id="backTop" class="back-link" href="#">
        ← Back to writings
      </a>
    </div>
  </header>

  <!-- ===== Post card ===== -->
  <main class="wrap">
    <article id="postCard" class="card post">
      <h1 id="postTitle">Loading…</h1>
      <p id="postMeta" class="meta"></p>
      <div id="postBody" class="body"></div>
      <a id="backCta" class="cta" href="#">↪ Back to Latest</a>
    </article>
  </main>

  <footer>
    © <span id="y"></span> Boluadeoye • All rights reserved.
  </footer>

  <script>
  (async function () {
    // --------- Resolve root (works for / and /Mywebsite/) ----------
    const parts = location.pathname.split('/').filter(Boolean);
    const root = (parts.length >= 2 && parts[parts.length-1] === 'post.html')
                  ? ('/' + parts[0] + '/')
                  : '/';
    const homeURL = new URL(root, location.origin).toString();

    // hook up both back links
    document.getElementById('brandHome').setAttribute('href', homeURL);
    document.getElementById('backTop').setAttribute('href', homeURL);
    document.getElementById('backCta').setAttribute('href', homeURL);

    // year in footer
    document.getElementById('y').textContent = new Date().getFullYear();

    // --------- Read ?file=... ----------
    const params = new URLSearchParams(location.search);
    const fileParam = params.get('file');
    const titleEl = document.getElementById('postTitle');
    const metaEl  = document.getElementById('postMeta');
    const bodyEl  = document.getElementById('postBody');

    if (!fileParam) {
      titleEl.textContent = "No post specified.";
      metaEl.textContent  = "";
      return;
    }

    // --------- Load meta from posts.json for consistent header ----------
    let meta = null;
    try{
      const postsUrl = new URL(root + 'posts.json', location.origin);
      // cache-bust to avoid CDN staleness on Pages
      postsUrl.searchParams.set('v', String(Date.now()));
      const res = await fetch(postsUrl.toString(), { cache: 'no-store' });
      if(res.ok){
        const list = await res.json();
        if(Array.isArray(list)){
          meta = list.find(p =>
            (p.url && p.url.includes(fileParam)) ||
            (p.file && p.file === fileParam)
          ) || null;
        }
      }
    }catch(e){ /* meta stays null if anything fails */ }

    // --------- Load the actual post HTML ----------
    try{
      const fileUrl = new URL(root + fileParam.replace(/^\//,''), location.origin);
      const res = await fetch(fileUrl.toString(), { cache:'no-store' });
      if(!res.ok) throw new Error(res.status + ' ' + res.statusText);
      const html = await res.text();
      const doc  = new DOMParser().parseFromString(html, 'text/html');

      // Prefer a scoped article/main so we don't pull in stray headers/footers
      let pick = doc.querySelector('article') || doc.querySelector('main');
      if(!pick){
        // very defensive fallback: strip layout-y elements from body
        const temp = doc.body.cloneNode(true);
        temp.querySelectorAll('header,nav,footer,script,style').forEach(n=>n.remove());
        pick = document.createElement('div');
        pick.innerHTML = temp.innerHTML;
      }

      // Extract title: use inner h1 if present; otherwise posts.json title
      let innerH1 = pick.querySelector('h1');
      const titleText = (innerH1 ? innerH1.textContent.trim() : (meta?.title || 'Untitled'));
      if(innerH1) innerH1.remove();                   // we’ll render our own h1
      titleEl.textContent = titleText;
      document.title = titleText + " • Boluadeoye";

      // Remove any in-article "Back to Latest/Writings" buttons/links to prevent duplicates
      pick.querySelectorAll('a').forEach(a=>{
        const t = (a.textContent||'').trim().toLowerCase();
        if(t.includes('back to latest') || t.includes('back to writings')) a.remove();
      });

      // Build meta line (date • minutes • TYPE) if available
      if(meta){
        const bits = [];
        if(meta.date)    bits.push(meta.date);
        if(meta.minutes) bits.push(`${meta.minutes} min read`);
        if(meta.type)    bits.push(String(meta.type).toUpperCase());
        metaEl.textContent = bits.join(' • ');
      }else{
        metaEl.textContent = '';
      }

      // Inject the article body
      bodyEl.innerHTML = pick.innerHTML.trim();

      // Fix internal relative links so they work from anywhere
      bodyEl.querySelectorAll('a[href]').forEach(a=>{
        const href = a.getAttribute('href');
        if(!href) return;
        const isExternal = /^(https?:)?\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('#');
        if(!isExternal){
          a.setAttribute('href', (root + href.replace(/^\//,'')));
        }
      });

    }catch(err){
      console.error(err);
      titleEl.textContent = "Couldn't load this post.";
      metaEl.textContent  = String(err.message || 'Unknown error');
      bodyEl.innerHTML    = "";
    }
  })();
  </script>
</body>
</html>
