<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lab</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-slate: #2D3748;
            --panel-cream: #F7FAFC;
            --accent-gold: #D69E2E;
            --accent-gold-hover: #ECC94B;
            --text-cream: #EDF2F7;
            --text-dark: #2D3748;
            --text-muted: #718096;
            --border-color: #CBD5E0;
            --transition-curve: cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg-slate) url("data:image/png;base64,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") repeat;
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding-top: 64px;
        }
        main { flex: 1; display: flex; align-items: center; justify-content: center; }
        .nav { position: fixed; top: 0; left: 0; width: 100%; background: var(--bg-slate); border-bottom: 1px solid var(--border-color); z-index: 1000; }
        .nav .wrap { display: flex; justify-content: space-between; align-items: center; height: 64px; max-width: 1200px; margin: 0 auto; padding: 0 32px; }
        .nav-home-link { color: var(--text-cream); text-decoration: none; font-weight: 700; font-size: 1.2rem; transition: color 200ms; }
        .nav-home-link:hover { color: var(--accent-gold); }
        .nav-links { list-style: none; display: flex; align-items: center; gap: 8px; margin: 0; padding: 0; }
        .nav-links a { display: block; text-decoration: none; color: var(--text-cream); font-weight: 700; padding: 8px 16px; border-radius: 999px; transition: all 200ms var(--transition-curve); }
        .nav-links a.active, .nav-links a:hover { background-color: var(--accent-gold); color: var(--bg-slate); }

        #foundry { text-align: center; max-width: 640px; width: 100%; padding: 32px; }
        #foundry-initial-view h1 { font-family: 'Lora', serif; font-size: 2.5rem; color: var(--text-cream); margin: 0 0 16px; }
        #foundry-initial-view p { font-size: 1.1rem; color: var(--text-muted); margin: 0 0 32px; }
        .btn-forge {
            display: inline-flex; align-items: center; gap: 12px; padding: 16px 32px; background: var(--accent-gold);
            color: var(--bg-slate); border: none; border-radius: 999px; font-weight: 700; font-size: 1.2rem;
            cursor: pointer; transition: all 200ms var(--transition-curve); box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .btn-forge:hover { background: var(--accent-gold-hover); transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
        .btn-forge svg { width: 24px; height: 24px; }

        #foundry-result-view { display: none; background: var(--panel-cream); padding: 32px; border-radius: 8px; text-align: left; }
        .result-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 16px; margin-bottom: 24px; }
        .result-header h2 { font-family: 'Lora', serif; margin: 0; }
        .btn-reforge { background: none; border: 1px solid var(--border-color); color: var(--text-muted); padding: 8px 16px; border-radius: 999px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 700; transition: all 200ms; }
        .btn-reforge:hover { background: #EDF2F7; color: var(--text-dark); border-color: var(--text-dark); }
        .result-section h3 { font-size: 1rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin: 24px 0 8px; }
        .result-section p, .result-section li { font-family: 'Lora', serif; font-size: 1.1rem; line-height: 1.7; }
        .result-section ul { list-style: none; padding: 0; margin: 0; }
        .result-section blockquote { border-left: 3px solid var(--accent-gold); padding-left: 16px; margin: 0; font-style: italic; }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 32px; }
        .btn-action { text-align: center; padding: 16px; border-radius: 8px; cursor: pointer; transition: all 200ms; }
        .btn-action h4 { margin: 0 0 4px; }
        .btn-action p { font-family: 'Inter', sans-serif; font-size: 0.9rem; margin: 0; }
        .btn-action.forge { background: var(--accent-gold); color: var(--bg-slate); border: 1px solid var(--accent-gold); }
        .btn-action.forge:hover { background: var(--accent-gold-hover); }
        .btn-action.archive { background: transparent; border: 1px solid var(--border-color); color: var(--text-dark); }
        .btn-action.archive:hover { background: #EDF2F7; border-color: var(--text-dark); }
        .archive-feedback { text-align: center; color: var(--accent-gold); font-weight: 700; margin-top: 16px; opacity: 0; transition: opacity 300ms; }
        .archive-feedback.show { opacity: 1; }
        
        .main-footer { width: 100%; padding: 2rem 0; background-color: var(--bg-slate); border-top: 1px solid var(--border-color); }
        .main-footer p { text-align: center; font-size: 0.9rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="wrap">
            <a href="#" class="nav-home-link" title="Return to Main Website">F</a>
            <ul class="nav-links">
                <li><a href="#" class="active">Lab</a></li>
                <li><a href="./anvil.html">Anvil</a></li>
                <li><a href="./journal.html">Journal</a></li>
                <li><a href="./academy.html">Academy</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section id="foundry">
            </section>
    </main>

    <footer class="main-footer">
        <div class="wrap">
            <p>© 2025 Boluadeoye • Crafted with passion</p>
        </div>
    </footer>

    <script>
        (function(){
            const foundryContainer = document.getElementById('foundry');
            let foundryData = null;
            let currentIdea = null;

            // --- UI Components ---
            const initialViewHTML = `
                <div id="foundry-initial-view">
                    <h1>The Lab</h1>
                    <p>Forge a new idea from the raw elements of storytelling.</p>
                    <button class="btn-forge" id="btn-generate">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M19 3v4M3 10h18M12 14v8m-4-4h8"/></svg>
                        <span>Forge a New Idea</span>
                    </button>
                </div>
            `;

            const resultViewHTML = `
                <div id="foundry-result-view">
                    <div class="result-header">
                        <h2>Forged Idea</h2>
                        <button class="btn-reforge" id="btn-reforge">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                            <span>Re-Forge</span>
                        </button>
                    </div>
                    <div id="result-content"></div>
                    <div class="action-buttons">
                        <div class="btn-action forge" id="btn-to-anvil">
                            <h4>Forge This Idea</h4>
                            <p>Take to The Anvil to begin writing.</p>
                        </div>
                        <div class="btn-action archive" id="btn-to-journal">
                            <h4>Archive This Idea</h4>
                            <p>Save to The Journal for later.</p>
                        </div>
                    </div>
                    <div class="archive-feedback" id="archive-feedback"></div>
                </div>
            `;

            // --- Main Functions ---
            const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

            function generateIdea() {
                const char = getRandomItem(foundryData.characters.archetypes);
                const conflict = getRandomItem(foundryData.conflicts.external);
                const setting = getRandomItem(foundryData.settings.locations);
                const question = getRandomItem(char.catalyst_questions);
                
                const logline = `In ${setting.name}, a(n) "${char.name}" driven by a need to "${char.motivation}" must confront the external conflict of "${conflict.text}", all while grappling with their personal flaw of "${char.flaw}".`;
                
                currentIdea = { char, conflict, setting, question, logline };
                displayIdea(currentIdea);
            }

            function displayIdea(idea) {
                foundryContainer.innerHTML = resultViewHTML;
                const resultContent = document.getElementById('result-content');
                
                resultContent.innerHTML = `
                    <div class="result-section">
                        <h3>Logline</h3>
                        <p>${idea.logline}</p>
                    </div>
                    <div class="result-section">
                        <h3>Deep Dive Question</h3>
                        <blockquote>${idea.question}</blockquote>
                    </div>
                    <div class="result-section">
                        <h3>Setting Palette</h3>
                        <ul>
                            <li><strong>Sight:</strong> ${idea.setting.sensory_palette.sight}</li>
                            <li><strong>Sound:</strong> ${idea.setting.sensory_palette.sound}</li>
                            <li><strong>Smell:</strong> ${idea.setting.sensory_palette.smell}</li>
                        </ul>
                    </div>
                `;
                
                // Add event listeners for the new view
                document.getElementById('btn-reforge').addEventListener('click', generateIdea);
                document.getElementById('btn-to-anvil').addEventListener('click', takeToAnvil);
                document.getElementById('btn-to-journal').addEventListener('click', archiveToJournal);
            }

            function showInitialView() {
                foundryContainer.innerHTML = initialViewHTML;
                document.getElementById('btn-generate').addEventListener('click', generateIdea);
            }
            
            function takeToAnvil() {
                localStorage.setItem('foundryAnvilPrompt', JSON.stringify(currentIdea));
                window.location.href = './anvil.html';
            }

            function archiveToJournal() {
                const dossiers = JSON.parse(localStorage.getItem('foundryDossiers')) || [];
                const newDossier = {
                    character: currentIdea.char.name,
                    setting: currentIdea.setting.name,
                    tension: currentIdea.question, // Using question as tension
                    tags: [...new Set([...(currentIdea.char.tags || []), ...(currentIdea.setting.tags || [])])],
                    notes: `Logline: ${currentIdea.logline}\n\nMotivation: ${currentIdea.char.motivation}\nFlaw: ${currentIdea.char.flaw}`
                };
                dossiers.unshift(newDossier);
                localStorage.setItem('foundryDossiers', JSON.stringify(dossiers));

                const feedback = document.getElementById('archive-feedback');
                feedback.textContent = 'Idea Archived in Journal!';
                feedback.classList.add('show');
                setTimeout(() => { feedback.classList.remove('show'); }, 2000);
            }

            async function initialize() {
                try {
                    // NOTE: Ensure you have a 'foundry-data.json' file in the same directory.
                    const response = await fetch('./foundry-data.json');
                    if (!response.ok) throw new Error('Could not load Foundry data.');
                    foundryData = await response.json();
                    showInitialView();
                } catch (error) {
                    foundryContainer.innerHTML = `<p style="color: var(--text-muted);">${error.message}</p>`;
                }
            }

            // --- Home Link Configuration ---
            // Please change the '#' to your main website's URL
            document.querySelector('.nav-home-link').href = '#';

            // --- Start the Lab ---
            initialize();
        })();
    </script>
</body>
</html>
