<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Academy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Lora&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-slate: #2D3748;
            --panel-cream: #F7FAFC;
            --accent-gold: #D69E2E;
            --accent-gold-hover: #ECC94B;
            --text-cream: #EDF2F7;
            --text-dark: #2D3748;
            --text-muted: #718096;
            --border-color: #4A5568;
            --transition: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg-slate) url("data:image/png;base64,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") repeat;
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding-top: 64px;
        }

        .nav { position: fixed; top: 0; left: 0; width: 100%; background: var(--bg-slate); border-bottom: 1px solid var(--border-color); z-index: 1000; }
        .nav .wrap { display: flex; justify-content: center; align-items: center; height: 64px; }
        .nav-links { list-style: none; display: flex; align-items: center; gap: 8px; padding: 0; margin: 0; }
        .nav-links a { display: block; text-decoration: none; color: var(--text-cream); font-weight: 700; padding: 8px 16px; border-radius: 999px; transition: all 300ms var(--transition); }
        .nav-links a.active { background-color: var(--accent-gold); color: var(--bg-slate); }
        .nav-links a:not(.active):hover { background-color: #4A5568; }

        main {
            flex: 1;
            padding: 32px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .view-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .view-toggle button {
            padding: 8px 16px;
            background: var(--panel-cream);
            border: 1px solid var(--border-color);
            border-radius: 999px;
            cursor: pointer;
            transition: all 300ms var(--transition);
            margin: 0 8px;
            font-weight: 700;
        }

        .view-toggle button.active {
            background: var(--accent-gold);
            color: var(--bg-slate);
            border-color: var(--accent-gold);
        }

        #library-view {
            display: block;
        }

        #codex-view {
            display: none;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .module-card {
            background: var(--panel-cream);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 300ms var(--transition);
            text-align: center;
            font-weight: 700;
        }

        .module-card:hover {
            background: var(--accent-gold-hover);
            border-color: var(--accent-gold);
        }

        #article-view {
            display: none;
            background: var(--panel-cream);
            padding: 32px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        #article-content {
            font-family: 'Lora', serif;
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-dark);
        }

        #crucible-btn {
            display: block;
            margin: 24px auto 0;
            padding: 12px 24px;
            background: var(--accent-gold);
            color: var(--bg-slate);
            border: none;
            border-radius: 999px;
            font-weight: 700;
            cursor: pointer;
            transition: all 300ms var(--transition);
        }

        #crucible-btn:hover {
            background: var(--accent-gold-hover);
        }

        #assessment-view {
            display: none;
            background: var(--panel-cream);
            padding: 32px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        #assessment-question {
            font-size: 1.2rem;
            margin-bottom: 16px;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--panel-cream);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 300ms var(--transition);
        }

        .option-btn:hover {
            background: var(--accent-gold-hover);
        }

        #feedback {
            margin-top: 16px;
            font-style: italic;
            color: var(--text-muted);
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--accent-gold);
            cursor: pointer;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 24px;
            justify-content: center;
        }

        .filter-tag {
            padding: 4px 12px;
            background: var(--panel-cream);
            border: 1px solid var(--border-color);
            border-radius: 999px;
            cursor: pointer;
            transition: all 300ms var(--transition);
        }

        .filter-tag.active {
            background: var(--accent-gold);
            color: var(--bg-slate);
            border-color: var(--accent-gold);
        }

        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .case-card {
            background: var(--panel-cream);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .case-card h3 {
            margin: 0 0 8px;
            font-size: 1.2rem;
        }

        .case-card p {
            margin: 0;
            font-family: 'Lora', serif;
            color: var(--text-muted);
        }

        .case-card .insight {
            font-family: 'Lora', serif;
            font-size: 1rem;
            line-height: 1.5;
            margin-top: 8px;
        }

        .main-footer { width: 100%; padding: 2rem 0; background-color: var(--bg-slate); border-top: 1px solid var(--border-color); }
        .main-footer p { text-align: center; font-size: 0.9rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="wrap">
            <ul class="nav-links">
                <li><a href="./lab.html">Lab</a></li>
                <li><a href="./anvil.html">Anvil</a></li>
                <li><a href="./journal.html">Journal</a></li>
                <li><a href="#" class="active">Academy</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="view-toggle">
            <button id="library-toggle" class="active">Learning Modules</button>
            <button id="codex-toggle">Rebellion Codex</button>
        </div>

        <div id="library-view">
            <div id="module-grid" class="module-grid"></div>
            <div id="article-view">
                <button class="back-btn" id="back-to-modules">← Back to Modules</button>
                <div id="article-content"></div>
                <button id="crucible-btn">Enter The Crucible</button>
            </div>
            <div id="assessment-view">
                <button class="back-btn" id="back-to-article">← Back to Article</button>
                <p id="assessment-question"></p>
                <div id="options"></div>
                <p id="feedback"></p>
            </div>
        </div>

        <div id="codex-view">
            <div class="filter-bar" id="codex-filter"></div>
            <div class="case-grid" id="case-grid"></div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="wrap">
            <p>© 2025 Boluadeoye • Crafted with passion</p>
        </div>
    </footer>

    <script>
        (function() {
            const libraryView = document.getElementById('library-view');
            const codexView = document.getElementById('codex-view');
            const libraryToggle = document.getElementById('library-toggle');
            const codexToggle = document.getElementById('codex-toggle');
            const moduleGrid = document.getElementById('module-grid');
            const articleView = document.getElementById('article-view');
            const assessmentView = document.getElementById('assessment-view');
            const articleContent = document.getElementById('article-content');
            const crucibleBtn = document.getElementById('crucible-btn');
            const backToModules = document.getElementById('back-to-modules');
            const backToArticle = document.getElementById('back-to-article');
            const assessmentQuestion = document.getElementById('assessment-question');
            const optionsDiv = document.getElementById('options');
            const feedback = document.getElementById('feedback');
            const codexFilter = document.getElementById('codex-filter');
            const caseGrid = document.getElementById('case-grid');

            let foundryData = null;
            let currentModule = null;
            let activeCodexFilter = null;

            const modules = [
                {
                    title: 'Mastering Plot',
                    article: '<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p><p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>',
                    assessment: {
                        question: 'What is the inciting incident in a plot?',
                        options: ['The climax', 'The event that sets the story in motion', 'The resolution'],
                        correct: 1,
                        feedback: 'Correct! The inciting incident is the event that disrupts the status quo and sets the protagonist on their journey.'
                    }
                },
                {
                    title: 'Crafting Dialogue',
                    article: '<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p><p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>',
                    assessment: {
                        question: 'What is the primary purpose of dialogue?',
                        options: ['To describe settings', 'To reveal character and advance the plot', 'To provide exposition only'],
                        correct: 1,
                        feedback: 'Correct! Dialogue should reveal character traits and move the story forward.'
                    }
                },
                {
                    title: 'Building Worlds',
                    article: '<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p><p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>',
                    assessment: {
                        question: 'What is key to effective world-building?',
                        options: ['Consistency and immersion', 'Random details', 'Overloading with information'],
                        correct: 0,
                        feedback: 'Correct! Consistency in rules and details helps immerse the reader in the world.'
                    }
                }
            ];

            // Render module grid
            function renderModules() {
                moduleGrid.innerHTML = '';
                modules.forEach(mod => {
                    const card = document.createElement('div');
                    card.classList.add('module-card');
                    card.textContent = mod.title;
                    card.addEventListener('click', () => {
                        currentModule = mod;
                        moduleGrid.style.display = 'none';
                        articleView.style.display = 'block';
                        articleContent.innerHTML = mod.article;
                    });
                    moduleGrid.appendChild(card);
                });
            }

            // Render assessment
            function renderAssessment() {
                assessmentQuestion.textContent = currentModule.assessment.question;
                optionsDiv.innerHTML = '';
                currentModule.assessment.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.classList.add('option-btn');
                    btn.textContent = opt;
                    btn.addEventListener('click', () => {
                        feedback.textContent = idx === currentModule.assessment.correct ? currentModule.assessment.feedback : 'Incorrect. Try again or review the article.';
                    });
                    optionsDiv.appendChild(btn);
                });
            }

            // View toggles
            libraryToggle.addEventListener('click', () => {
                libraryToggle.classList.add('active');
                codexToggle.classList.remove('active');
                libraryView.style.display = 'block';
                codexView.style.display = 'none';
            });

            codexToggle.addEventListener('click', () => {
                codexToggle.classList.add('active');
                libraryToggle.classList.remove('active');
                libraryView.style.display = 'none';
                codexView.style.display = 'block';
            });

            // Library navigation
            backToModules.addEventListener('click', () => {
                articleView.style.display = 'none';
                moduleGrid.style.display = 'grid';
            });

            crucibleBtn.addEventListener('click', () => {
                articleView.style.display = 'none';
                assessmentView.style.display = 'block';
                renderAssessment();
            });

            backToArticle.addEventListener('click', () => {
                assessmentView.style.display = 'none';
                articleView.style.display = 'block';
                feedback.textContent = '';
            });

            // Codex
            async function loadCodex() {
                try {
                    const response = await fetch('./foundry-data.json');
                    if (!response.ok) throw new Error('Failed to load data');
                    foundryData = await response.json();
                    const allTypes = new Set(foundryData.caseStudies.map(cs => cs.element_type));
                    const types = Array.from(allTypes).sort();

                    codexFilter.innerHTML = '';
                    types.forEach(type => {
                        const span = document.createElement('span');
                        span.classList.add('filter-tag');
                        span.textContent = type;
                        span.addEventListener('click', () => {
                            activeCodexFilter = activeCodexFilter === type ? null : type;
                            document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
                            if (activeCodexFilter) span.classList.add('active');
                            renderCodex();
                        });
                        codexFilter.appendChild(span);
                    });

                    renderCodex();
                } catch (error) {
                    caseGrid.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                }
            }

            function renderCodex() {
                caseGrid.innerHTML = '';
                const filtered = activeCodexFilter ? foundryData.caseStudies.filter(cs => cs.element_type === activeCodexFilter) : foundryData.caseStudies;
                filtered.forEach(cs => {
                    const card = document.createElement('div');
                    card.classList.add('case-card');
                    card.innerHTML = `
                        <h3>${cs.work} by ${cs.author}</h3>
                        <p>Type: ${cs.element_type}</p>
                        <div class="insight">${cs.insight}</div>
                    `;
                    caseGrid.appendChild(card);
                });
            }

            // Init
            renderModules();
            loadCodex();
        })();
    </script>
</body>
</html>
