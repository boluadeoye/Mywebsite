<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Journal - The Writer's Foundry</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* The Modern Aesthetic Palette */
            --bg-light-gray: #F4F7FA;
            --panel-white: #FFFFFF;
            --primary-blue: #0052CC;
            --hover-blue: #0065FF;
            --text-dark: #172B4D;
            --text-muted: #6B778C;
            --border-color: #DFE1E6;
            
            /* Timing Function & Spacing Grid (8px system) */
            --transition-curve: cubic-bezier(0.4, 0, 0.2, 1);
            --space-8: 8px;
            --space-16: 16px;
            --space-24: 24px;
        }

        /* --- Global Styles & Typography --- */
        *, *::before, *::after { box-sizing: border-box; }

        body {
            background-color: var(--bg-light-gray);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            font-weight: 400;
            color: var(--text-dark);
            margin: 0;
            padding: calc(64px + var(--space-24)) var(--space-16) var(--space-24) var(--space-16);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* --- Unified Navigation Bar --- */
        .foundry-nav {
            position: fixed; top: 0; left: 0; width: 100%;
            background-color: var(--panel-white);
            box-shadow: 0 2px 8px rgba(23, 43, 77, 0.05);
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 var(--space-24); height: 64px; z-index: 1000;
        }
        .nav-brand {
            font-weight: 800; font-size: 1.2rem;
            color: var(--text-dark); text-decoration: none;
        }
        .nav-links { display: flex; gap: var(--space-24); }
        .nav-links a {
            text-decoration: none; color: var(--text-muted);
            font-weight: 700; font-size: 1rem;
            padding: var(--space-8) 0;
            border-bottom: 2px solid transparent;
            transition: color 0.2s var(--transition-curve);
        }
        .nav-links a:hover { color: var(--text-dark); }
        .nav-links a.active { color: var(--primary-blue); border-bottom-color: var(--primary-blue); }

        /* --- Journal Layout --- */
        .journal-wrap {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-24);
            flex-wrap: wrap;
            gap: var(--space-16);
        }
        .journal-header h1 {
            font-weight: 800;
            font-size: 2rem;
            margin: 0;
        }
        
        .controls-group { display: flex; gap: var(--space-8); }
        .control-btn {
            background-color: #EBECF0;
            border: 1px solid transparent;
            border-radius: 6px;
            padding: var(--space-8) var(--space-16);
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-dark);
            transition: all 0.2s var(--transition-curve);
        }
        .control-btn:hover { background-color: #dfe1e6; }
        .control-btn.danger { color: #DE350B; }
        .control-btn.danger:hover { background-color: #FFBDAD; color: #BF2600; }

        /* --- Idea Cards --- */
        .journal-list {
            display: grid;
            gap: var(--space-24);
        }
        .idea-card {
            background-color: var(--panel-white);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 12px -8px rgba(23, 43, 77, 0.1);
            transition: all 0.2s var(--transition-curve);
        }
        .idea-card:hover {
             transform: translateY(-4px);
             box-shadow: 0 8px 24px -8px rgba(23, 43, 77, 0.2);
        }
        .idea-content { padding: var(--space-24); }
        .idea-content h3 {
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            color: var(--text-muted);
            letter-spacing: 0.5px;
            margin: 0 0 var(--space-8) 0;
        }
        .idea-content p {
            font-size: 1rem;
            line-height: 1.6;
            margin: 0 0 var(--space-24) 0;
        }
        .idea-content p:last-child { margin-bottom: 0; }

        /* Notes Textarea */
        .notes-area {
            width: 100%;
            border: none;
            border-top: 1px solid var(--border-color);
            border-radius: 0 0 12px 12px;
            padding: var(--space-16);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light-gray);
            resize: vertical;
            min-height: 100px;
            transition: all 0.2s var(--transition-curve);
        }
        .notes-area:focus {
            outline: 2px solid var(--primary-blue);
            outline-offset: -2px;
            background-color: var(--panel-white);
        }

        /* --- Empty State --- */
        #empty-state {
            text-align: center;
            padding: calc(var(--space-32) * 2) var(--space-24);
            background-color: var(--panel-white);
            border: 2px dashed var(--border-color);
            border-radius: 16px;
        }
        #empty-state h2 { font-weight: 800; font-size: 1.5rem; margin: 0 0 var(--space-16) 0; }
        #empty-state p { color: var(--text-muted); margin: 0 0 var(--space-24) 0; font-size: 1rem; line-height: 1.6; }
        #empty-state a {
            background-color: var(--primary-blue);
            color: var(--panel-white);
            border-radius: 8px;
            padding: var(--space-16) var(--space-24);
            font-size: 1.1rem;
            font-weight: 700;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s var(--transition-curve);
        }
        #empty-state a:hover {
            background-color: var(--hover-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px -2px rgba(0, 82, 204, 0.3);
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            body { padding: 64px 0 16px 0; }
            .journal-wrap { padding: 0 var(--space-16); }
            .journal-header { margin-top: var(--space-16); }
        }
    </style>
</head>
<body>

    <nav class="foundry-nav">
        <a href="lab.html" class="nav-brand">The Forge</a>
        <div class="nav-links">
            <a href="lab.html">Forge</a>
            <a href="anvil.html">Anvil</a>
            <a href="journal.html" class="active">Journal</a>
        </div>
    </nav>

    <main class="journal-wrap">
        <div class="journal-header">
            <h1>Your Journal</h1>
            <div class="controls-group">
                <button class="control-btn" id="export-btn">Export All</button>
                <button class="control-btn danger" id="clear-btn">Clear Journal</button>
            </div>
        </div>

        <div id="journal-list" class="journal-list">
            </div>

        <div id="empty-state" style="display: none;">
            <h2>Your Journal is Empty</h2>
            <p>Go to The Forge to generate and save new story ideas.</p>
            <a href="lab.html">Forge a New Idea</a>
        </div>
    </main>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const JournalApp = {
            // --- State & Properties ---
            state: {
                ideas: [],
                notes: {}
            },
            dom: {},
            keys: {
                ideas: 'foundryJournal',
                notes: 'foundryJournalNotes'
            },
            
            // --- Initialization ---
            init() {
                this.cacheDOM();
                this.loadData();
                this.render();
                this.bindEvents();
                console.log("The Journal is open.");
            },
            
            cacheDOM() {
                this.dom.journalList = document.getElementById('journal-list');
                this.dom.emptyState = document.getElementById('empty-state');
                this.dom.exportBtn = document.getElementById('export-btn');
                this.dom.clearBtn = document.getElementById('clear-btn');
            },
            
            // --- Data Handling ---
            loadData() {
                this.state.ideas = JSON.parse(localStorage.getItem(this.keys.ideas) || '[]');
                this.state.notes = JSON.parse(localStorage.getItem(this.keys.notes) || '{}');
            },
            
            saveNotes() {
                localStorage.setItem(this.keys.notes, JSON.stringify(this.state.notes));
            },
            
            // --- Rendering ---
            render() {
                this.dom.journalList.innerHTML = '';
                if (this.state.ideas.length === 0) {
                    this.dom.emptyState.style.display = 'block';
                    this.dom.journalList.style.display = 'none';
                } else {
                    this.dom.emptyState.style.display = 'none';
                    this.dom.journalList.style.display = 'grid';
                    this.state.ideas.forEach(idea => {
                        const card = this.createIdeaCard(idea);
                        this.dom.journalList.appendChild(card);
                    });
                }
            },
            
            createIdeaCard(idea) {
                const card = document.createElement('div');
                card.className = 'idea-card';
                card.dataset.id = idea.id;

                const ideaNote = this.state.notes[idea.id] || '';

                card.innerHTML = `
                    <div class="idea-content">
                        <h3>Archetype</h3>
                        <p>${idea.archetype.name}</p>
                        <h3>Conflict</h3>
                        <p>${idea.conflict.text}</p>
                        <h3>Setting</h3>
                        <p>${idea.setting.name}</p>
                    </div>
                    <textarea class="notes-area" placeholder="Your notes and thoughts on this idea..." data-id="${idea.id}">${ideaNote}</textarea>
                `;

                // Auto-save notes on input
                const textarea = card.querySelector('.notes-area');
                let noteTimeout;
                textarea.addEventListener('input', () => {
                    clearTimeout(noteTimeout);
                    noteTimeout = setTimeout(() => {
                        this.state.notes[idea.id] = textarea.value;
                        this.saveNotes();
                    }, 500); // Debounce saving
                });

                return card;
            },

            // --- Event Binding & Actions ---
            bindEvents() {
                this.dom.exportBtn.addEventListener('click', () => this.exportJournal());
                this.dom.clearBtn.addEventListener('click', () => this.clearJournal());
            },

            exportJournal() {
                if (this.state.ideas.length === 0) {
                    alert('Journal is empty. Nothing to export.');
                    return;
                }

                let fileContent = 'The Writer\'s Foundry - Journal Export\n';
                fileContent += '========================================\n\n';

                this.state.ideas.forEach((idea, index) => {
                    const note = this.state.notes[idea.id] || 'No notes.';
                    fileContent += `## IDEA ${index + 1}\n\n`;
                    fileContent += `### Archetype\n${idea.archetype.name}\n\n`;
                    fileContent += `### Conflict\n${idea.conflict.text}\n\n`;
                    fileContent += `### Setting\n${idea.setting.name}\n\n`;
                    fileContent += `### Notes\n${note}\n\n`;
                    fileContent += '----------------------------------------\n\n';
                });
                
                this.downloadFile('foundry-journal.txt', fileContent);
            },

            clearJournal() {
                if (this.state.ideas.length === 0) {
                    alert('Journal is already empty.');
                    return;
                }
                if (confirm('Are you sure you want to permanently delete all ideas and notes in your journal? This cannot be undone.')) {
                    localStorage.removeItem(this.keys.ideas);
                    localStorage.removeItem(this.keys.notes);
                    this.state.ideas = [];
                    this.state.notes = {};
                    this.render();
                }
            },

            // --- Utility ---
            downloadFile(filename, content) {
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }
        };

        JournalApp.init();
    });
    </script>
</body>
</html>
